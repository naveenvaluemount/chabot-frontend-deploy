"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[885],{4885:(re,C,s)=>{s.r(C),s.d(C,{TemplatesModule:()=>u});var c=s(6895),A=s(3060),l=s(4006),y=s(3419),Z=s(9080),d=s(2722),N=s(4482),U=s(5403);function x(){return(0,N.e)((o,t)=>{let a,n=!1;o.subscribe((0,U.x)(t,i=>{const p=a;a=i,n&&t.next([p,i]),n=!0}))})}var e=s(4650),L=s(9274),O=s(7401),I=s(7009),q=s(4859),E=s(7392),J=s(284),T=s(9549),G=s(4385),R=s(3238),Y=s(266),Q=s(2173);const S=["orgTemp"],F=["createdTemp"],M=["updatedTemp"],H=["actionsTemp"],w=["publishTemp"],P=["publishonTemp"],j=["statusTemp"];function D(o,t){if(1&o&&(e.TgZ(0,"div",9),e._UZ(1,"div"),e.TgZ(2,"div",10)(3,"div",11),e._uU(4),e.qZA(),e.TgZ(5,"div",12),e._uU(6),e.qZA()()()),2&o){const a=t.row;e.xp6(1),e.uIk("acronym",null==a?null:a.clientName),e.xp6(3),e.Oqu(null==a?null:a.clientName),e.xp6(2),e.Oqu(null==a?null:a.domain)}}function k(o,t){1&o&&(e._uU(0),e.ALo(1,"date")),2&o&&e.hij(" ",e.xi3(1,1,t.row.createdTime,"mediumDate")," ")}function z(o,t){1&o&&(e._uU(0),e.ALo(1,"date")),2&o&&e.hij(" ",e.xi3(1,1,t.row.updatedTime,"mediumDate")," ")}function W(o,t){if(1&o&&e._UZ(0,"app-status-badge",13),2&o){const a=t.row;e.Q6J("className","active"===a.status?"bg-blue-500":"bg-gray-400")("label",a.status)}}function K(o,t){if(1&o&&(e.TgZ(0,"app-status-badge",13)(1,"div",12),e._uU(2),e.ALo(3,"date"),e.qZA()()),2&o){const a=t.row;e.Q6J("className",a.publishedStatus?"bg-green-500":"bg-red-500")("label",a.publishedStatus?"Published":"Un Published"),e.xp6(2),e.Oqu(e.xi3(3,3,a.publishedOn,"mediumDate"))}}function B(o,t){if(1&o){const a=e.EpF();e.TgZ(0,"div",14)(1,"button",15),e.NdJ("click",function(){const p=e.CHM(a).row,r=e.oxw();return e.KtG(r.deleteFn(p))}),e._UZ(2,"mat-icon",16),e.qZA(),e.TgZ(3,"button",17),e.NdJ("click",function(){const p=e.CHM(a).row,r=e.oxw();return e.KtG(r.updateFn(p))}),e._UZ(4,"mat-icon",16),e.qZA()()}if(2&o){const a=t.row;e.xp6(1),e.Q6J("disabled",a.publishedStatus),e.xp6(1),e.Q6J("svgIcon","heroicons_outline:trash"),e.xp6(2),e.Q6J("svgIcon","heroicons_outline:pencil")}}function $(o,t){if(1&o&&(e.TgZ(0,"mat-option",25),e._uU(1),e.qZA()),2&o){const a=t.$implicit;e.Q6J("value",a.value),e.xp6(1),e.hij(" ",a.name," ")}}function X(o,t){if(1&o&&(e.TgZ(0,"mat-option",25),e._uU(1),e.qZA()),2&o){const a=t.$implicit;e.Q6J("value",a.value),e.xp6(1),e.hij(" ",a.name," ")}}function V(o,t){if(1&o&&(e.TgZ(0,"form",18)(1,"div",19)(2,"mat-form-field",20)(3,"mat-label"),e._uU(4,"Published"),e.qZA(),e.TgZ(5,"mat-select",21)(6,"mat-option",22),e._uU(7,"All"),e.qZA(),e.YNc(8,$,2,2,"mat-option",23),e.qZA()()(),e.TgZ(9,"div",19)(10,"mat-form-field",20)(11,"mat-label"),e._uU(12,"Status"),e.qZA(),e.TgZ(13,"mat-select",24)(14,"mat-option",22),e._uU(15,"All"),e.qZA(),e.YNc(16,X,2,2,"mat-option",23),e.qZA()()()()),2&o){const a=e.oxw();e.Q6J("formGroup",a.filter),e.xp6(8),e.Q6J("ngForOf",a.publishedList),e.xp6(8),e.Q6J("ngForOf",a.statusList)}}function ee(o,t){if(1&o&&(e.TgZ(0,"mat-option",25),e._uU(1),e.qZA()),2&o){const a=t.$implicit;e.Q6J("value",a.value),e.xp6(1),e.hij(" ",a.name," ")}}function te(o,t){1&o&&(e.TgZ(0,"mat-error"),e._uU(1,"*Required "),e.qZA())}function ae(o,t){1&o&&(e.TgZ(0,"mat-error"),e._uU(1,"*Required "),e.qZA())}function oe(o,t){if(1&o&&(e.TgZ(0,"mat-option",25),e._uU(1),e.qZA()),2&o){const a=t.$implicit;e.Q6J("value",a.value),e.xp6(1),e.hij(" ",a.name," ")}}function ne(o,t){1&o&&(e.TgZ(0,"mat-error"),e._uU(1,"*Required "),e.qZA())}function se(o,t){if(1&o&&(e.TgZ(0,"mat-option",25),e._uU(1),e.qZA()),2&o){const a=t.$implicit;e.Q6J("value",a.value),e.xp6(1),e.Oqu(a.name)}}function ie(o,t){if(1&o&&(e.TgZ(0,"div",36)(1,"div")(2,"div",19)(3,"mat-form-field",20)(4,"mat-label"),e._uU(5,"Section"),e.qZA(),e.TgZ(6,"mat-select",37)(7,"div"),e.YNc(8,se,2,2,"mat-option",23),e.qZA()()()(),e.TgZ(9,"mat-form-field",38)(10,"mat-label"),e._uU(11,"Value"),e.qZA(),e._UZ(12,"input",39),e.qZA(),e.TgZ(13,"mat-form-field",38)(14,"mat-label"),e._uU(15,"Example"),e.qZA(),e._UZ(16,"input",40,41),e.qZA()()()),2&o){const a=t.index,n=e.oxw(2);e.Q6J("formGroupName",a),e.xp6(8),e.Q6J("ngForOf",n.sectionList)}}function le(o,t){if(1&o){const a=e.EpF();e.TgZ(0,"form",18)(1,"div",26)(2,"div",19)(3,"mat-form-field",27)(4,"mat-label"),e._uU(5,"Category"),e.qZA(),e.TgZ(6,"mat-select",28),e.YNc(7,ee,2,2,"mat-option",23),e.qZA(),e.YNc(8,te,2,0,"mat-error",29),e.qZA()(),e.TgZ(9,"div",19)(10,"mat-form-field",27)(11,"mat-label"),e._uU(12,"Name"),e.qZA(),e._UZ(13,"input",30),e.YNc(14,ae,2,0,"mat-error",29),e.qZA()(),e.TgZ(15,"div",19)(16,"mat-form-field",27)(17,"mat-label"),e._uU(18,"Language"),e.qZA(),e.TgZ(19,"mat-select",31),e.YNc(20,oe,2,2,"mat-option",23),e.qZA(),e.YNc(21,ne,2,0,"mat-error",29),e.qZA()(),e.TgZ(22,"div",19)(23,"div",32),e._uU(24,"Content "),e.TgZ(25,"mat-icon",33),e.NdJ("click",function(){e.CHM(a);const i=e.oxw();return e.KtG(i.addContent())}),e.qZA()(),e.TgZ(26,"div",34),e.YNc(27,ie,18,2,"div",35),e.qZA()(),e._uU(28),e.ALo(29,"json"),e.qZA()()}if(2&o){const a=e.oxw();e.Q6J("formGroup",a.form),e.xp6(7),e.Q6J("ngForOf",a.categoryList),e.xp6(1),e.Q6J("ngIf",a.form.get("category").hasError("required")),e.xp6(6),e.Q6J("ngIf",a.form.get("templateName").hasError("required")),e.xp6(6),e.Q6J("ngForOf",a.languageList),e.xp6(1),e.Q6J("ngIf",a.form.get("language").hasError("required")),e.xp6(6),e.Q6J("ngForOf",a.form.get("content").controls),e.xp6(1),e.hij("\n",e.lcZ(29,8,a.form.value)," ")}}class g extends y.f{constructor(t,a,n,i,p,r){super(),this.api=t,this.fb=a,this.cd=n,this.fcs=i,this.snackbar=p,this.router=r,this.isEmpty=!1,this.isLoaded=!1,this.breadcrumbs=[{name:"Home",link:""},{name:"Templates",link:""}],this.form=this.fb.group({category:["",[l.kI.required]],templateName:["",[l.kI.required]],language:["",[l.kI.required]],content:this.fb.array([]),templateId:[null]}),this.filter=this.fb.group({status:["all"],published_status:["all"]}),this.statusList=[{id:0,name:"Active",value:"active"},{id:1,name:"In Active",value:"inActive"}],this.sectionList=[{id:0,name:"Header",value:"HEADER"},{id:1,name:"Body",value:"BODY"},{id:1,name:"Footer",value:"FOOTER"}],this.languageList=[{id:0,name:"en",value:"en"}],this.categoryList=[{id:0,name:"MARKETING",value:"MARKETING"},{id:1,name:"UTILITY",value:"UTILITY"},{id:1,name:"AUTHENTICATION",value:"AUTHENTICATION"}],this.publishedList=[{id:0,name:"Published",value:"published"},{id:1,name:"Un Published",value:"unPublished"}],this.params={keyword:"",colName:"organization_name",pageSize:25,pageNumber:0,orderby:!1,status:"",published_status:"",pageCount:0,pageSizes:[5,10,25]},this.exp=[],this.showExample=!1,this.data=[{id:0,templateName:"Ecommerce",category:"static",language:"EN",status:"active",modifiedOn:"5862486355"},{id:1,templateName:"Food",category:"static",language:"EN",status:"inActive",modifiedOn:"545212545"},{id:2,templateName:"Silver",category:"static",language:"EN",status:"active",modifiedOn:"75122563"}]}getList(){this.templates=this.data,this.isLoaded=!0,this.isEmpty=!1,this.api.allTemplates().pipe((0,d.R)(this.unsubscribe)).subscribe(t=>{200===t.statusCode&&(this.isLoaded=!0,0!==t.response.length&&(this.isEmpty=!1,this.templates=t.response,console.log("template List",this.templates),this.params.pageCount=t.response.count,this.isEmpty=0==t.response.count))})}ngOnInit(){this.getList()}ngAfterViewInit(){this.columns=[{prop:"templateName",name:"Template Name",sort:!0},{prop:"category",name:"Category",sort:!0},{prop:"status",name:"Status",sort:!0},{prop:"language",name:"Language",sort:!0},{prop:"modifiedOn",name:"Modified On",sort:!0},{prop:"actions",name:"Actions",cellTemplate:this.actionsTemp}],this.cd.detectChanges()}content(){return this.form.get("content")}newContent(t){return this.fb.group(t?{templateId:t.id?t.id:"",section:t.section?t.section:"",value:t.value?t.value:"",example:[t.example]}:{templateId:[null],section:[""],value:[""],example:[[]]})}addContent(t){t?(console.log(this.form.get("content").value.length),this.content().push(this.newContent(t))):this.content().push(this.newContent()),this.form.get("content").controls.forEach((n,i)=>{console.log("contextIndex",i);const p=n.get("value"),r=n.get("example");p.valueChanges.pipe(x()).subscribe(([h,m])=>{const _=n.get("value");if(h!==m){_.patchValue(m);const v=h.match(/{{\d+}}/g)?.length||0,f=m.match(/{{\d+}}/g)?.length||0;if(console.log(f),this.showExample=f>0,v!=f){const b=n.get("example");b.value?.length>f&&b.patchValue(b.value.splice(0,f))}}}),r.valueChanges.pipe(x()).subscribe(([h,m])=>{const _=n.get("example");console.log(typeof m),h!==m&&(m="string"==typeof m?m.split(",").map(v=>v.trim()):m,_.patchValue(m))})})}onSubmit(){console.log(this.form.value),this.form.valid?this.api.addTemplate(this.form.value).pipe((0,d.R)(this.unsubscribe)).subscribe(t=>{console.log(t),200===t.statusCode&&200===t.statusCode&&(this.crud.toggle(null),this.isLoaded=!1,this.snackbar.open("Template Added",null,{duration:1e3}),this.getList())}):this.form.markAllAsTouched()}onUpdate(){this.form.valid?this.api.addTemplate(this.form.value).pipe((0,d.R)(this.unsubscribe)).subscribe(t=>{200===t.statusCode&&200===t.response.statusCode&&(this.crud.toggle(null),this.isLoaded=!1,this.snackbar.open("Template Updated",null,{duration:1e3}),this.getList())}):this.form.markAllAsTouched()}onChange(t){this.form.get("templateId")?.value?this.content().removeAt(0):(this.form.reset(),this.content().clear())}updateFn(t){console.log(t),this.crud.toggle("edit"),this.form.patchValue({category:t.category,templateName:t.templateName,language:t.language,content:this.fb.array[t.content?.map(a=>{this.addContent(a)})]}),this.form.get("templateId").setValue(t.id)}deleteFn(t){this.fcs.open().afterClosed().pipe((0,d.R)(this.unsubscribe)).subscribe(n=>{"confirmed"===n&&this.api.deleteTemplate(t.id).pipe((0,d.R)(this.unsubscribe)).subscribe(i=>{200===i.statusCode&&(this.isLoaded=!1,this.snackbar.open("Template Deleted",null,{duration:1e3}),this.getList())})})}onPageChange(t){this.params.pageNumber=t.pageIndex,this.params.pageSize=t.pageSize,this.getList()}getSecret(t){this.router.navigate(["manageOrganizations/code",t.id]),this.api.secret=t.secret}onApply(){this.params.published_status=this.filter.value.published_status,this.params.status=this.filter.value.status,this.getList(),this.crud.filterToggle()}onSearch(t){this.isLoaded=!1,this.params.keyword=t.value?t.value:"",this.getList()}}g.\u0275fac=function(t){return new(t||g)(e.Y36(L.sM),e.Y36(l.qu),e.Y36(e.sBO),e.Y36(O.R),e.Y36(I.ux),e.Y36(A.F0))},g.\u0275cmp=e.Xpm({type:g,selectors:[["app-templates"]],viewQuery:function(t,a){if(1&t&&(e.Gf(Z.D,5),e.Gf(S,5),e.Gf(F,5),e.Gf(M,5),e.Gf(H,5),e.Gf(w,5),e.Gf(P,5),e.Gf(j,5)),2&t){let n;e.iGM(n=e.CRH())&&(a.crud=n.first),e.iGM(n=e.CRH())&&(a.orgTemp=n.first),e.iGM(n=e.CRH())&&(a.createdTemp=n.first),e.iGM(n=e.CRH())&&(a.updatedTemp=n.first),e.iGM(n=e.CRH())&&(a.actionsTemp=n.first),e.iGM(n=e.CRH())&&(a.publishTemp=n.first),e.iGM(n=e.CRH())&&(a.publishonTemp=n.first),e.iGM(n=e.CRH())&&(a.statusTemp=n.first)}},hostAttrs:[1,"flex","flex-col","flex-auto"],features:[e.qOj],decls:17,vars:8,consts:[[3,"isEmpty","isLoaded","rows","columns","breadcrumbs","whatsAppTemplate","filterTemplate","pagination","onPageChange","onSubmit","onUpdate","onApply","onChange","onSearch"],["orgTemp",""],["createdTemp",""],["updatedTemp",""],["statusTemp",""],["publishTemp",""],["actionsTemp",""],["filterTemplate",""],["formTemplate",""],["role","button",1,"flex","items-center"],[1,"ml-4","mr-auto"],[1,"font-semibold"],[1,"text-sm","text-gray-400"],[3,"className","label"],[1,"flex","items-center"],["type","button","mat-icon-button","","matTooltip","Delete","data-cy","delete",3,"disabled","click"],[3,"svgIcon"],["type","button","mat-icon-button","","matTooltip","Update","data-cy","edit",3,"click"],[3,"formGroup"],[1,"col-span-2"],["hideRequiredMarker","",1,"w-full"],["name","published_status","formControlName","published_status"],["value",""],[3,"value",4,"ngFor","ngForOf"],["name","status","formControlName","status"],[3,"value"],[1,"grid","grid-cols-1","gap-4"],["hideRequiredMarker","","subscriptSizing","dynamic",1,"w-full"],["name","Category","formControlName","category"],[4,"ngIf"],["matInput","","formControlName","templateName","data-cy","templateName"],["name","language","formControlName","language"],[1,"text-lg","font-bold"],["svgIcon","heroicons_outline:plus","role","button",1,"ml-auto",3,"click"],["formArrayName","content",1,"mt-3","-mx-8"],["class","px-8 py-3 bg-gray-100 rounded mb-2",3,"formGroupName",4,"ngFor","ngForOf"],[1,"px-8","py-3","bg-gray-100","rounded","mb-2",3,"formGroupName"],["data-cy","content","formControlName","section"],[1,"w-full"],["matInput","","formControlName","value","data-cy","value"],["matInput","","formControlName","example","data-cy","example"],["exmp",""]],template:function(t,a){if(1&t&&(e.TgZ(0,"app-crud",0),e.NdJ("onPageChange",function(i){return a.onPageChange(i)})("onSubmit",function(){return a.onSubmit()})("onUpdate",function(){return a.onUpdate()})("onApply",function(){return a.onApply()})("onChange",function(i){return a.onChange(i)})("onSearch",function(i){return a.onSearch(i)}),e.qZA(),e.YNc(1,D,7,3,"ng-template",null,1,e.W1O),e.YNc(3,k,2,4,"ng-template",null,2,e.W1O),e.YNc(5,z,2,4,"ng-template",null,3,e.W1O),e.YNc(7,W,1,2,"ng-template",null,4,e.W1O),e.YNc(9,K,4,6,"ng-template",null,5,e.W1O),e.YNc(11,B,5,3,"ng-template",null,6,e.W1O),e.YNc(13,V,17,3,"ng-template",null,7,e.W1O),e.YNc(15,le,30,10,"ng-template",null,8,e.W1O)),2&t){const n=e.MAs(14),i=e.MAs(16);e.Q6J("isEmpty",a.isEmpty)("isLoaded",a.isLoaded)("rows",a.templates)("columns",a.columns)("breadcrumbs",a.breadcrumbs)("whatsAppTemplate",i)("filterTemplate",n)("pagination",a.params)}},dependencies:[c.sg,c.O5,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,l.x0,l.CE,Z.D,q.RK,E.Hw,J.Nt,T.KE,T.hX,T.TO,G.gD,R.ey,Y.gM,Q.e,c.Ts,c.uU]});var me=s(2665);const pe=[{path:"",component:g}];class u{}u.\u0275fac=function(t){return new(t||u)},u.\u0275mod=e.oAB({type:u}),u.\u0275inj=e.cJS({imports:[c.ez,me.m,A.Bz.forChild(pe)]})}}]);